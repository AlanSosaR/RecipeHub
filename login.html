<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>RecipeHub Personal Gateway</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Epilogue:wght@600;700;800&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1"
        rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>

<body class="login-body">
    <div class="login-card-premium animate-fade-in">

        <!-- Header -->
        <div class="login-header">
            <div class="login-icon-box">
                <span class="material-symbols-outlined" style="font-size: 32px">menu_book</span>
            </div>
            <h1 id="main-title" class="login-title">
                Bienvenido a tu Recetario
            </h1>
            <p id="main-subtitle" class="login-subtitle">
                Tu colección privada de recetas, escaneadas y organizadas.
            </p>
        </div>

        <!-- Form -->
        <form id="unified-form" class="login-form">
            <div>
                <label class="login-label" for="email">Dirección de Email</label>
                <input class="input-premium" id="email" placeholder="ejemplo@correo.com" type="email" required />
            </div>
            <div>
                <label class="login-label" for="password">Contraseña Segura</label>
                <input class="input-premium" id="password" placeholder="••••••••" type="password" required />
            </div>

            <div style="padding-top: 8px;">
                <button type="submit" id="btn-submit" class="btn-full btn-primary-gradient">
                    <span style="font-size: 16px;">Ingresar</span>
                </button>
            </div>
        </form>

        <!-- Divider -->
        <div class="divider-text">
            <span>o continuar con</span>
        </div>

        <!-- Social Buttons -->
        <div style="display: flex; flex-direction: column; gap: 12px;">
            <button onclick="window.utils.showToast('Google disponible pronto')" class="btn-full btn-google">
                <svg class="w-5 h-5" style="width: 20px; height: 20px;" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                        fill="#4285F4"></path>
                    <path
                        d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                        fill="#34A853"></path>
                    <path
                        d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                        fill="#FBBC05"></path>
                    <path
                        d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                        fill="#EA4335"></path>
                </svg>
                <span>Google</span>
            </button>

            <button onclick="window.utils.showToast('Apple disponible pronto')" class="btn-full btn-apple">
                <i class="fa-brands fa-apple" style="font-size: 20px;"></i>
                <span>Apple</span>
            </button>

            <button onclick="handleSwitch()" class="btn-full"
                style="background: transparent; color: var(--primary); margin-top: 8px;">
                <span class="material-symbols-outlined" style="font-size: 20px;">mail</span>
                <span id="switch-text">Crear cuenta con email</span>
            </button>
        </div>

        <!-- Footer -->
        <div style="margin-top: 32px; text-align: center;">
            <p
                style="font-size: 10px; color: #9CA3AF; text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700;">
                RecipeHub Personal • 2026
            </p>
        </div>

        <!-- Blooms -->
        <div class="blob-decoration blob-1"></div>
        <div class="blob-decoration blob-2"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>

    <script>
        let isLogin = true;

        function handleSwitch() {
            isLogin = !isLogin;
            const title = document.getElementById('main-title');
            const subtitle = document.getElementById('main-subtitle');
            const btnSubmit = document.getElementById('btn-submit');
            const switchText = document.getElementById('switch-text');

            if (isLogin) {
                title.textContent = "Bienvenido a tu Recetario";
                subtitle.textContent = "Tu colección privada de recetas, escaneadas y organizadas.";
                btnSubmit.querySelector('span').textContent = "Ingresar";
                switchText.textContent = "Crear cuenta con email";
            } else {
                title.textContent = "Únete a RecipeHub";
                subtitle.textContent = "Comienza a organizar tu legado culinario hoy mismo.";
                btnSubmit.querySelector('span').textContent = "Registrarse";
                switchText.textContent = "Ya tengo cuenta, ingresar";
            }
        }

        document.getElementById('unified-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const btn = document.getElementById('btn-submit');

            // Usamos window.utils para mayor seguridad si está disponible, sino directo
            const loader = window.utils ? window.utils.setButtonLoading : window.setButtonLoading; // Fallback logic handled in utils.js usually
            const toaster = window.utils ? window.utils.showToast : (window.showToast || console.log);

            if (isLogin) {
                if (window.utils) window.utils.setButtonLoading(btn, true, 'Ingresando...');
                const result = await window.authManager.signIn(email, password);
                if (window.utils) window.utils.setButtonLoading(btn, false, 'Ingresar');

                if (result.success) {
                    window.location.href = 'index.html';
                } else {
                    if (window.utils) window.utils.showToast(result.error || 'Error al ingresar', 'error');
                }
            } else {
                if (window.utils) window.utils.setButtonLoading(btn, true, 'Creando...');
                const result = await window.authManager.signUp(email, password, 'Chef', '');
                if (window.utils) window.utils.setButtonLoading(btn, false, 'Registrarse');

                if (result.success) {
                    if (window.utils) window.utils.showToast('¡Cuenta creada! Revisa tu email.', 'success');
                    setTimeout(() => handleSwitch(), 3000);
                } else {
                    if (window.utils) window.utils.showToast(result.error || 'Error al registrarse', 'error');
                }
            }
        });

        window.addEventListener('load', async () => {
            // Check if utils key functions are global or under utils
            if (!window.utils) {
                console.warn("Utils not loaded, providing minimal fallback");
                window.utils = {
                    showToast: (msg) => alert(msg),
                    setButtonLoading: (btn, loading, text) => {
                        btn.disabled = loading;
                        btn.querySelector('span').textContent = text;
                    }
                };
            }

            const isAuth = await window.authManager.checkAuth();
            if (isAuth) window.location.href = 'index.html';
        });
    </script>
</body>

</html>